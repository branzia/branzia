on: push
name: ðŸš€ Deploy website on push
jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    steps:
     
    - name: ðŸšš Get latest code
      uses: actions/checkout@v4
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'

    - name: Install Composer dependencies
      run: composer install --no-dev --no-interaction --prefer-dist --optimize-autoloader

    - name: Set directory permissions
      run: chmod -R 775 storage bootstrap/cache
    - name: Generate .env file from secrets
      run: |
        echo "APP_NAME=Laravel" >> .env
        echo "APP_ENV=production" >> .env
        echo "APP_KEY=base64:f00mMyy0P+cbbvWW7HIszbeczHeAZnTpQ613yre/GL4=" >> .env
        echo "APP_DEBUG=false" >> .env
        echo "APP_URL=https://yourapp.infinityfreeapp.com" >> .env
        echo "DB_CONNECTION=mysql" >> .env
        echo "DB_HOST=sql203.infinityfree.com" >> .env
        echo "DB_PORT=3306" >> .env
        echo "DB_DATABASE=if0_39285485_yourdb" >> .env
        echo "DB_USERNAME=if0_39285485" >> .env
        echo "DB_PASSWORD=y0mXcK2L1ZU" >> .env

    - name: ðŸ“‚ Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ftpupload.net
        port: 21
        username: if0_39285485
        password: y0mXcK2L1ZU
        server-dir: /htdocs/
        local-dir: ./     